# Legacy and iconic sites {#sec-legacy-sites}

In this section we discuss our approach to account for legacy and iconic sites in the sampling design.
Legacy sites are historical or current surveys in which locations were randomly chosen, in contrast to iconic sites, which are obtained from non-random surveys.
In this report, we will refer to both iconic and legacy sites as historical sites.
These sites are particularly important in Quebec, where there are a large number of legacy and iconic sites (@fig-legacy-sites).
Given the high cost of sampling in remote regions and the limited resources available to sample, it is essential to take historical sites into account in order to make the most efficient use of limited resources to extend spatial coverage to under-sampled areas.

The latest method to integrate legacy and iconic sites is developed in @Foster2021.
They use the position of each historical site to reduce the inclusion probability of neighboring sites following a kernel distribution, where the legacy effect decreases with distance from a historical site.
However, their approach to incorporate legacy and iconic sites do not explicitly consider the amount of historical sites, nor the spatial randomness of their distribution.
In fact, their approach naturally ensures randomnly selected sites, as they use only legacy sites while excluding iconic ones.
They justify the exclusion of iconic sites, since these sites are usually special cases that may not represent the population and therefore generate a biased sample.
Although we agree with the authors, we prioritised expanding the spatial coverage of samples by reducing the sample size of regions that have been well covered by historical sites.

In the following section we describe the historical sites for the study area.
Then, we use two ecoregions as examples to discuss the decision to also consider sample size while accounting for historical sites.
In the next chapter we describe our novel approach to account for the spatial randomness of historical sites to adjust the inclusion probability and the sample size.
Finally, we briefly describe previous experimentations to incorporate historical sites.

## Historical sites in the study area

*TODO: describe the different sources*

```{r legacyFigure,echo=FALSE,message=FALSE,warning=FALSE,fig.width=7,fig.height=7}
#| label: fig-legacy-sites
#| fig-cap: "Legacy and historical sites from the study area."

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(spsurvey))
suppressPackageStartupMessages(library(ggtext))

# load layers
area <- readRDS(file.path('..', 'data', 'area.RDS'))

legacy <- read_csv(file.path('..', 'data', 'legacySites.csv'), show_col_types = FALSE) |>
        st_as_sf(
            coords = c('longitude', 'latitude'),
            crs = st_crs(4326)
        ) |>
        mutate(Source = str_replace(Source, "'", ""))

#plot
area |>
    ggplot() +
    geom_sf(color = 'grey') +
    geom_sf(data = legacy, aes(color = Source), size = .5) +
    coord_sf(crs = 4326) +
    theme_minimal() +
    xlab('') + ylab('')
```


## Why should we consider sample size?

Here, we discuss why changing inclusion probability alone is insufficient by comparing two ecoregions with oposite spatial distributions of historical sites.
While the ecoregion 99 has evenly distributed historical sites over space, the ecoregion 217 present most of its historical sites around roads.
We begin by outlining the method for reducing the inclusion probability of sites near legacy sites from @Foster2021, which we then apply to the two contrasting ecoregions.

Every PSU hexagon is assigned an inclusion probability as a function of habitat and access cost.
The effect of a legacy site ($l$) on the inclusion probability of neighbouring hexagons ($h$) is derived from the Euclidean distance between $h$ and $l$ ($d(h, l)$), and the amplitude effect $\sigma$ using a Gaussian function.
@fig-foster-gaussian shows the one-dimensional effect of increasing values of $\sigma$ on the inclusion probability of neighbouring sites.

```{r fosterGaussian,echo=FALSE,message=FALSE,warning=FALSE,fig.width=6,fig.height=5}
#| label: fig-foster-gaussian
#| fig-cap: "Legacy effect in the inclusion probabiity of neighbouring sites in function their Euclian distance. Each line represents the effect range of legacy sites."

# exp function
gausFunc = function(dist, sigma) return ( exp(-dist^2/sigma^2) )
# Diff parameter values
sigmas = c(1000, 4000, 6000, 10000, 15000, 20000)
# viz
tibble(Dist = seq(1, 40000, 100)) |>
    expand_grid(sigma = sigmas) |>
    mutate(eff = gausFunc(Dist, sigma)) |>
    ggplot(aes(x = Dist, y = eff, color = as.factor(sigma))) +
        geom_line(size = 1.1) +
        theme_minimal() +
        xlab('Distance from legacy site (m)') + ylab('Legacy site effect') +
        scale_colour_viridis_d(guide = guide_legend(title = expression("" ~ sigma ~ "")))
```

The method to reduce the inclusion probability of neighbouring sites near legacy sites developed in @Foster2021 is implemented  in the R package `MBHdesign`.
We redrew their illustration using a simulated grid landscape with three legacy sites to ilustrate the effect of increasing the $\sigma$ parameter on the inclusion probability of adjacent sites (@fig-foster-landscape).

```{r legacyExample,echo=FALSE,message=FALSE,warning=FALSE,fig.width=7,fig.height=6}
#| label: fig-foster-landscape
#| fig-cap: "Effect of increasing the effect (sigma) of three legacy sites (white dots) on the inclusion probability of neighbouring sites. Each square is a simulated sampling grid with different inclusion probability described by the color gradient. Inclusion probability increases from dark blue (low) to yellow (high)."

#number of samples
n <- 10
#number of points to sample from
N <- 100^2
#the sampling grid (offset so that the edge locations have same area)
offsetX <- 1/(2*sqrt( N))
my.seq <- seq(from=offsetX, to=100000-offsetX, length=sqrt(N))
X <- expand.grid( my.seq, my.seq)
#the legacy sites (three of them)
set.seed(10)
legacySites <- matrix(sample(1:100000, 6, replace = FALSE), ncol = 2, byrow = TRUE)
#names can be useful
colnames(X) <- colnames( legacySites) <- c("X1","X2")

#non-uniform inclusion probabilities
inclProbs <- 1-exp(-X[,1]/100000)
#scaling to enforce summation to n
inclProbs <- n * inclProbs / sum( inclProbs)

# adj according to different values of sigma
sigmas <- c(2000, 10000, 40000)

incl_ls <- readRDS(file.path('data', 'inclProb_figFoster.RDS'))

par(mfrow = c(2, 2), mar = c(0.5, 0.5, 1.5, 0.5), oma = c(1.5, 1.5, .5, 0), mgp = c(1.2, 0.2, 0), tck = -.008, cex = 0.8)
for(i in 1:length(incl_ls)) {
    plot(X, pch = 19, cex = 1.2, col = viridis::viridis(N)[rank(incl_ls[[i]])], 
    xlab = '', ylab = '', xaxt = 'n', yaxt = 'n')
    axis(1, labels = F)
    axis(2, labels = F)
    mtext(names(incl_ls)[i], 3, line = 0) 
    points(legacySites, pch = 21, bg = 'grey', cex = 1.5)
}
```

We applied the same approach for two ecoregion with contrasting spatial distribution of historical sites.
By using the spatially balanced design to sample new sites while omitting historical sites, the selected hexagons are evenly distributed throughout the ecoregion, some of which overlap with the historical sites (@fig-sampleSize-example1).
Adjusting the probability of inclusion of hexagons, given their distance to historical locations, increases the spatial coverage of underrepresented areas (@fig-sampleSize-example2).

```{r runGRTS_eco101,echo=FALSE,message=FALSE,warning=FALSE,fig.width=7,fig.height=7}
#| label: fig-sampleSize-example1
#| fig-cap: "Example of when sampling sites (red dots) using the spatially balanced design without taking historical sites into account. Ecoregion 99 and 207 are two examples of legacy sites in which the legacy sites (blue dots) are evenly and non-uniformly distributed in space, respectively."

# Load selected hexagons
sel_hex <- readRDS(file.path('data', 'selected_hexas_eco99_eco217.RDS'))

sel_hex |>
    st_union() |>
    ggplot() +
    geom_sf(fill = 'lightgrey') +
    geom_sf(data = sel_hex |> filter(nbLegacySites > 0), fill = 'blue', color = 'transparent', alpha = .55) +
    geom_sf(data = sel_hex |> filter(selected_mdcaty == 1), fill = 'red', color = 'transparent') +
    geom_textbox(
        aes(x = -74.1, y = 52.2, label = "**Ecoregion 217**<br><span style='color:red'>Sample size</span>: 46<br><span style='color:blue'>Legacy sites</span>: 96"),
        width = .22
    ) +
    geom_textbox(
        aes(x = -77.5, y = 49, label = "**Ecoregion 99**<br><span style='color:red'>Sample size</span>: 71<br><span style='color:blue'>Legacy sites</span>: 579"),
        width = .22
    ) +
    coord_sf(crs = 4326) +
    theme_minimal() +
    theme(legend.position = 'none') +
    xlab('') + ylab('')
```


```{r runGRTS_eco101_adj,echo=FALSE,message=FALSE,warning=FALSE,fig.width=7,fig.height=7}
#| label: fig-sampleSize-example2
#| fig-cap: "Example of when sites are sampled from a design in which only the inclusion probability is adjusted when incorporating historical sites. Ecoregion 99 and 207 are two examples of legacy sites in which the legacy sites (blue dots) are evenly and non-uniformly distributed in space, respectively."

sel_hex |>
    st_union() |>
    ggplot() +
    geom_sf(fill = 'lightgrey') +
    geom_sf(data = sel_hex |> filter(nbLegacySites > 0), fill = 'blue', color = 'transparent', alpha = .55) +
    geom_sf(data = sel_hex |> filter(selected_adjp == 1), fill = 'red', color = 'transparent') +
    geom_textbox(
        aes(x = -74.1, y = 52.2, label = "**Ecoregion 217**<br><span style='color:red'>Sample size</span>: 46<br><span style='color:blue'>Legacy sites</span>: 96"),
        width = .22
    ) +
    geom_textbox(
        aes(x = -77.5, y = 49, label = "**Ecoregion 99**<br><span style='color:red'>Sample size</span>: 71<br><span style='color:blue'>Legacy sites</span>: 579"),
        width = .22
    ) +
    coord_sf(crs = 4326) +
    theme_minimal() +
    theme(legend.position = 'none') +
    xlab('') + ylab('')
```

The issue is that when an ecoregion is well covered by historical sites, the sampled hexagons are driven to cluster in smaller available areas.
When the inclusion probability was adjusted for ecoregion 99, almost a third of the sampled hexagons were clustered in a 20 km buffer.
In the next section, we will build on this approach so the sample size may also be adjusted in response to historical sites.
